<!DOCTYPE html>
<html>
	<head>
		<title>Demo</title>
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/epoch/0.8.4/css/epoch.min.css" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/epoch/0.8.4/js/epoch.min.js"></script>
	</head>
	<body>
		<div id="chart" style="height: 500px" class="epoch"></canvas>
		<script>
			$(function() {
				var chart = $("#chart").epoch({
					type: "time.line",
					axes: ["left", "right"],
					range: {
						left: [-1000, 1000],
						right: [-1000, 1000]
					},
					data: [{
						label: "Sensor 0",
						values: [],
						range: [-1000, 1000]
					}, {
						label: "Sensor 1",
						values: [],
						range: [-1000, 1000]
					}, {
						label: "Sensor 2",
						values: [],
						range: [-1000, 1000]
					}, {
						label: "Sensor 3",
						values: [],
						range: [-1000, 1000]
					}, {
						label: "Sensor 4",
						values: [],
						range: [-1000, 1000]
					}]
				});

				var socket = new WebSocket("ws://localhost:8888/data");

				socket.onmessage = function(e) {
					var messages = e.data.split("\n");

					for(var i=0; i<messages.length; i++) {
						if(messages[i] !== "") {
							var message = JSON.parse(messages[i]);
							var entry = [];

							for(var j=0; j<message.data.length; j++) {
								entry.push({
									//time: message.timestamp,
									time: new Date(),
									y: message.data[j]
								});
							}

							chart.push(entry);
						}
					}
				}
			});
		</script>
	</body>
</html>