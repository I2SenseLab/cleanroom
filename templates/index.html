<!DOCTYPE html>
<html>
	<head>
		<title>Demo</title>
	</head>
	<body>
		<canvas id="chart" width="100%" height="50%"></canvas>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
		<script>
			// Color palette: https://www.colourlovers.com/palette/1930/cheer_up_emo_kid
			var chart = new Chart(document.getElementById("chart"), {
				type: "line",
				data: {
					datasets: [{
						label: "Sensor 0",
						borderColor: "rgb(85, 98, 112)",
						fill: false,
						data: []
					}, {
						label: "Sensor 1",
						fill: false,
						borderColor: "rgb(78, 205, 196)",
						data: []
					}, {
						label: "Sensor 2",
						borderColor: "rgb(199, 244, 100)",
						fill: false,
						data: []
					}, {
						label: "Sensor 3",
						borderColor: "rgb(255, 107, 107)",
						fill: false,
						data: []
					}, {
						label: "Sensor 4",
						borderColor: "rgb(196, 77, 88)",
						fill: false,
						data: []
					}]
				},
				options: {
					elements: {
						line: {
							tension: 0 // disable bezier curves for performance
						}
					}
				}
			});

			var socket = new WebSocket("ws://localhost:8888/data");

			socket.onmessage = function(e) {
				var messages = e.data.split("\n");

				for(var i=0; i<messages.length; i++) {
					if(messages[i] !== "") {
						var message = JSON.parse(messages[i]);

						for(var j=0; j<message.data.length; j++) {
							var dataset = chart.data.datasets[j];

							console.log(message.timestamp, message.data[j]);

							dataset.data.push({
								x: message.timestamp,
								y: message.data[j]
							});

							if(dataset.length > 100) {
								dataset.shift();
							}
						}
					}
				}

				chart.update();
			}
		</script>
	</body>
</html>